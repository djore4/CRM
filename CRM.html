<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>BMW Sales Hub - Gest√£o de Oportunidades</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f7f6; color: #333; padding: 20px; }
        .container { max-width: 900px; margin: auto; }
        h1 { color: #1c69d4; border-bottom: 2px solid #1c69d4; padding-bottom: 10px; }
        .card { background: white; padding: 20px; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border-left: 8px solid #ccc; }
        .urgente { border-left-color: #e74c3c; background: #fff5f5; } /* Alerta para atrasos */
        .em-dia { border-left-color: #27ae60; }
        .meta { font-size: 0.9em; color: #666; }
        .badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 0.8em; font-weight: bold; background: #eee; }
    </style>
</head>
<body>

<div class="container">
    <h1>üèéÔ∏è CRM BMW: Oportunidades da Equipa</h1>
    <div id="lista-oportunidades">Carregando oportunidades...</div>
</div>

<script>
    // 1. CONFIGURA√á√ÉO (Substitua pelos dados do seu Supabase)
    const supabaseUrl = 'SUA_URL_AQUI';
    const supabaseKey = 'SUA_CHAVE_ANON_AQUI';
    const _supabase = supabase.createClient(supabaseUrl, supabaseKey);

    async function carregarOportunidades() {
        // 2. BUSCAR DADOS
        const { data, error } = await _supabase
            .from('opportunities')
            .select('*')
            .order('next_contact', { ascending: true });

        if (error) {
            document.getElementById('lista-oportunidades').innerHTML = "Erro ao ligar ao Supabase.";
            return;
        }

        // 3. MOSTRAR NO ECR√É
        let html = '';
        const agora = new Date();

        data.forEach(op => {
            const dataContacto = new Date(op.next_contact);
            const isAtrasado = dataContacto <= agora;
            const classeUrgencia = isAtrasado ? 'urgente' : 'em-dia';

            html += `
                <div class="card ${classeUrgencia}">
                    <div style="float: right"><span class="badge">${op.status}</span></div>
                    <h3>${op.client_name} <small>(${op.car_model})</small></h3>
                    <p>${op.notes || 'Sem observa√ß√µes.'}</p>
                    <div class="meta">
                        <strong>üìÖ Pr√≥ximo Contacto:</strong> ${dataContacto.toLocaleString()} 
                        ${isAtrasado ? ' <b style="color:red">‚ö†Ô∏è ATRASADO</b>' : ''}
                    </div>
                </div>
            `;
        });

        document.getElementById('lista-oportunidades').innerHTML = html || "Nenhuma oportunidade encontrada.";
    }

    carregarOportunidades();
</script>

</body>
</html>
